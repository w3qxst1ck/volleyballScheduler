from database.schemas import User, EventRel, Event, PaymentsEventsUsers, Payment
from routers.utils import convert_date, convert_time
from settings import settings


def user_profile_message(user: User) -> str:
    """–°–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–æ—Ñ–∏–ª–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    user_lvl = f"üîù –£—Ä–æ–≤–µ–Ω—å: " + settings.levels[user.level] if user.level else f"üîù –£—Ä–æ–≤–µ–Ω—å: –µ—â–µ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω"
    message = f"–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å\n\nüë§ {user.firstname} {user.lastname}\n{user_lvl}"

    return message


# –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞
def event_card_for_user_message(event: EventRel, payment: Payment | None) -> str:
    """–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–±—ã—Ç–∏–∏ —Å –µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏"""
    date = convert_date(event.date)
    time = convert_time(event.date)

    user_registered_count = len(event.users_registered)

    message = f"üìÖ <b>{date}</b> <b>{time}</b>\n"

    # –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—â–µ –Ω–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª—Å—è
    if not payment:
        pass

    # –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã
    elif not payment.paid_confirm:
        message += "‚è≥ –û–∂–∏–¥–∞–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\n\n"

    # –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ
    else:
        message += "‚úÖ –í—ã <b>–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã</b> –Ω–∞ —ç—Ç–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ\n\n"

    message += f"<b>\"{event.type}\"</b>\n" \
               f"{event.title}\n" \
               f"–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å: {settings.levels[event.level]}\n\n" \
               f"üí∞ –¶–µ–Ω–∞: <b>{event.price} —Ä—É–±.</b>\n\n" \
               f"üë• –£—á–∞—Å—Ç–Ω–∏–∫–æ–≤: {user_registered_count}/{event.places} (<b>—Å–≤–æ–±–æ–¥–Ω—ã—Ö –º–µ—Å—Ç {event.places - user_registered_count}</b>)\n" \
               f"‚ö†Ô∏è –ú–∏–Ω. –∫–æ–ª-–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤: <b>{event.min_user_count}</b>\n\n"

    # –µ—Å–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∏ —É–∂–µ –µ—Å—Ç—å
    if event.users_registered:
        # —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∏–º–µ–Ω–∏
        event.users_registered = sorted(event.users_registered, key=lambda user: user.firstname)

        message += "–£—á–∞—Å—Ç–Ω–∏–∫–∏:\n"
        for idx, user in enumerate(event.users_registered, 1):
            message += f"<b>{idx}.</b> <a href='tg://user?id={user.tg_id}'>{user.firstname} {user.lastname}</a> " \
                       f"{f'({settings.levels[user.level]})' if user.level else ''}\n"

        # message += "\n–î–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –¥–∏–∞–ª–æ–≥ —Å —É—á–∞—Å—Ç–Ω–∏–∫–æ–º –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –µ–≥–æ –∏–º—è"

    return message


# PAYMENTS
def invoice_message_for_user(event: Event) -> str:
    """–°–æ–æ–±—â–µ–Ω–∏–µ –æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è"""
    message = f"–¶–µ–Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è <b>\"{event.title} {convert_date(event.date)} –≤ {convert_time(event.date)}\"</b> - <b>{event.price} —Ä—É–±.</b>\n\n"
    message += f"–î–ª—è –∑–∞–ø–∏—Å–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–ø–ª–∞—Ç—É –ø–µ—Ä–µ–≤–æ–¥–æ–º <b>{event.price}</b> —Ä—É–±. –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É: \n\n{settings.admin_phone}\n\n"
    message +=  f"‚ùó<b>–í–ê–ñ–ù–û: –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –æ–ø–ª–∞—Ç–µ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤), " \
               f"—É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ –≤–∞—à–µ–º –ø—Ä–æ—Ñ–∏–ª–µ</b>\n\n" \
               f"–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É <b>\"–û–ø–ª–∞—Ç–∏–ª\"</b>"
    return message


def event_levels_card_for_admin_message(event: EventRel) -> str:
    """–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–±—ã—Ç–∏–∏ –¥–ª—è –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è —É—Ä–æ–≤–Ω–µ–π"""
    date = convert_date(event.date)
    time = convert_time(event.date)

    message = f"üìÖ <b>{date} {time}</b>\n\n" \
              f"<b>\"{event.type}\"</b>\n" \
              f"{event.title}\n\n" \

    if event.users_registered:
        # —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∏–º–µ–Ω–∏
        event.users_registered = sorted(event.users_registered, key=lambda user: user.firstname)

        message += "–£—á–∞—Å—Ç–Ω–∏–∫–∏:\n"
        for idx, user in enumerate(event.users_registered, 1):
            message += f"<b>{idx}.</b> <a href='tg://user?id={user.tg_id}'>{user.firstname} {user.lastname}</a> " \
                       f"{f'({settings.levels[user.level]})' if user.level else ''}\n"

        message += "\n–ß—Ç–æ–±—ã –≤—ã—Å—Ç–∞–≤–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å —É—á–∞—Å—Ç–Ω–∏–∫–∞, –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –Ω–æ–º–µ—Ä–æ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞"

    # –µ—Å–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –Ω–µ—Ç
    else:
        message += "<b>–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –Ω–µ—Ç</b>"

    return message


def notify_deleted_user_message(event: EventRel) -> str:
    """–û–ø–æ–≤–µ—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ —Ç–æ–º, —á—Ç–æ –µ–≥–æ —É–¥–∞–ª–∏–ª–∏ –∏–∑ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è"""
    date = convert_date(event.date)
    time = convert_time(event.date)
    message = f"üîî <i>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</i>\n\n" \
              f"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —É–¥–∞–ª–∏–ª –≤–∞—Å –∏–∑ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è <b>\"{date} {time} {event.title}\"</b>!\n\n" \
              f"–î–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π –≤—ã –º–æ–∂–µ—Ç–µ —Å–≤—è–∑–∞—Ç—å—Å—è —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º @{settings.main_admin_url}"

    return message


def notify_set_level_message(level: int) -> str:
    """–°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–∏—Å–≤–æ–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è"""
    message = f"üîî <i>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</i>\n\n" \
              f"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø—Ä–∏—Å–≤–æ–∏–ª –≤–∞–º —É—Ä–æ–≤–µ–Ω—å <b>\{settings.levels[level]}\</b>"

    return message


def notify_message(event: EventRel) -> str:
    """–°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ —Å–æ–±—ã—Ç–∏–∏"""
    event_date = convert_date(event.date)
    event_time = convert_time(event.date)
    message = f"üîî <i>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</i>\n\n" \
              f"–ù–∞–ø–æ–º–∏–Ω–∞–µ–º, —á—Ç–æ –≤—ã –∑–∞–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ <b>\"{event.title}\"</b>, " \
              f"–∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–æ–π–¥–µ—Ç <b>{event_date}</b> –≤ <b>{event_time}</b>\n\n" \
              f"–ï—Å–ª–∏ —É –≤–∞—Å –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è –ø—Ä–∏–π—Ç–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–æ–±—â–∏—Ç–µ –æ–± —ç—Ç–æ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É @{settings.main_admin_url}"

    return message


def notify_canceled_event(event: EventRel) -> str:
    """–°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Ç–º–µ–Ω–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –≤ —Å–≤—è–∑–∏ —Å –Ω–µ—Ö–≤–∞—Ç–∫–æ–π —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤"""
    event_date = convert_date(event.date)
    event_time = convert_time(event.date)
    message = f"üîî <i>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</i>\n\n" \
              f"–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ <b>\"{event.title}\"</b>, –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ <b>{event_date}</b> –≤ <b>{event_time}</b>, " \
              f"<b>–æ—Ç–º–µ–Ω–µ–Ω–æ</b> –≤ —Å–≤—è–∑–∏ —Å –Ω–µ—Ö–≤–∞—Ç–∫–æ–π —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\n\n" \
              f"–ü–æ –≤–æ–ø—Ä–æ—Å—É –≤–æ–∑–≤—Ä–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É @{settings.main_admin_url}"

    return message


def get_help_message() -> str:
    """–°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∫–æ–º–∞–Ω–¥—ã /help"""
    message = "<b>–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –±–æ—Ç–∞:</b>\n" \
              "- –î–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –≤–æ–ª–µ–π–±–æ–ª—å–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è\n" \
              "- –ù–∞–ø–æ–º–∏–Ω–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –æ –ø—Ä–∏–±–ª–∏–∂–∞—é—â–∏—Ö—Å—è —Å–æ–±—ã—Ç–∏—è—Ö\n\n" \
              "<b>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:</b>\n" \
              "- –î–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É \"üë®üèª‚Äçüíª –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\"\n" \
              "- –í–æ –≤–∫–ª–∞–¥–∫–µ \"üë§ –ü—Ä–æ—Ñ–∏–ª—å\" –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ –∏ —É—Ä–æ–≤–µ–Ω—å (‚ùó —É—Ä–æ–≤–µ–Ω—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)\n" \
              "- –î–ª—è –∑–∞–ø–∏—Å–∏ –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É \"üóìÔ∏è–í—Å–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è\", –¥–∞–ª–µ–µ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â—É—é –¥–∞—Ç—É –∏ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–µ–µ –≤–∞—Å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ.\n" \
              "–î–ª—è –∑–∞–ø–∏—Å–∏ –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –≤—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å —É—Ä–æ–≤–µ–Ω—å –Ω–µ –Ω–∏–∂–µ —Ç—Ä–µ–±—É–µ–º–æ–≥–æ, —Ç–∞–∫–∂–µ –∑–∞–ø–∏—Å—å –≤–æ–∑–º–æ–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –º–µ—Å—Ç.\n" \
              "‚ùó–û–±—Ä–∞—â–∞–µ–º –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º\n" \
              "- –í–æ –≤–∫–ª–∞–¥–∫–µ \"üèê –ú–æ–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è\" –≤—ã –º–æ–∂–µ—Ç–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥–∞–ª–∏ –∑–∞—è–≤–∫—É –∏–ª–∏ –∑–∞–ø–∏—Å–∞–ª–∏—Å—å\n\n" \
              "<b>–ö–æ–Ω—Ç–∞–∫—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏:</b>\n" \
              f"–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞—à–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤ —Ç–µ–ª–µ–≥—Ä–∞–º: @{settings.main_admin_url}"

    return message


